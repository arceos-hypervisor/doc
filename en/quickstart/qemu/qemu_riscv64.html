<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>QEMU-riscv64 - AxVisor Book</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../src/assets/css/custom.css">
        <link rel="stylesheet" href="../../theme/pagetoc.css">
        <link rel="stylesheet" href="../../theme/language-picker.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">AxVisor Book</h1>

                    <div class="right-buttons">
                        <button id="language-toggle" class="icon-button" type="button"
                                title="Change language" aria-label="Change language"
                                aria-haspopup="true" aria-expanded="false"
                                aria-controls="language-list">
                            <i class="fa fa-globe"></i>
                        </button>
                        <ul id="language-list" class="theme-popup" aria-label="Languages" role="menu">
                          <li role="none"><button role="menuitem" class="theme">
                              <a id="zh-CN">中文</a>
                          </button></li>
                          <li role="none"><button role="menuitem" class="theme">
                              <a id="en">English</a>
                          </button></li>
                        </ul>
                        <script>
                          let langToggle = document.getElementById("language-toggle");
                          let langList = document.getElementById("language-list");
                          langToggle.addEventListener("click", (event) => {
                              langList.style.display = langList.style.display == "block" ? "none" : "block";
                          });
                          let selectedLang = document.getElementById("en");
                          if (selectedLang) {
                              selectedLang.parentNode.classList.add("theme-selected");
                          }

                          // The path to the root, taking the current
                          // language into account.
                          let full_path_to_root = "../../../";
                          // The page path (mdbook only gives us
                          // access to the path to the Markdown file).
                          let path = "quickstart/qemu/qemu_riscv64.md".replace(/\.md$/, ".html");
                          for (let lang of langList.querySelectorAll("a")) {
                              if (lang.id == "zh-CN") {
                                  lang.href = `${full_path_to_root}${path}`;
                              } else {
                                  lang.href = `${full_path_to_root}${lang.id}/${path}`;
                              }
                          }

                          // When the user clicks a list item, the page jump is performed, just like clicking the internal <a> tag.
                          langList.querySelectorAll("li").forEach(function(li) {
                            li.addEventListener("click", function(event) {
                              event.preventDefault();
        
                              let link = this.querySelector("a");
                              if (link && window.location.href !== link.href) {
                                window.location.href = link.href;
                              }
                            });
                          });
                        </script>

                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/arceos-hypervisor/doc" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="run-axvisor-on-qemu-riscv64"><a class="header" href="#run-axvisor-on-qemu-riscv64">Run AxVisor on QEMU riscv64</a></h1>
<p>目前，在 QEMU riscv64 平台上已经对独立运行 ArceOS 和 nimbos 进行了验证。</p>
<h2 id="arceos"><a class="header" href="#arceos">ArceOS</a></h2>
<h3 id="准备-arceos-镜像"><a class="header" href="#准备-arceos-镜像">准备 ArceOS 镜像</a></h3>
<ol>
<li>
<p>获取 ArceOS 主线代码 <code>git clone https://github.com/arceos-org/arceos.git</code></p>
</li>
<li>
<p>在 <code>arceos</code> 源码目录中执行 <code>make ARCH=riscv64 SMP=1 A=examples/helloworld</code> 获得 <code>examples/helloworld/helloworld_riscv64-qemu-virt.bin</code></p>
</li>
</ol>
<h3 id="从文件系统加载运行"><a class="header" href="#从文件系统加载运行">从文件系统加载运行</a></h3>
<p>获取 AxVisor 主线代码 <code>git clone git@github.com:arceos-hypervisor/axvisor.git</code>，然后在 <code>axvisor</code> 源码目录中执行如下步骤：</p>
<ol>
<li>
<p>制作一个磁盘镜像文件，并将 ArceOS 客户机镜像放到磁盘镜像文件系统中</p>
<ol>
<li>
<p>使用 <code>make disk_img</code> 命令生成一个空的 FAT32 磁盘镜像文件 <code>disk.img</code></p>
</li>
<li>
<p>手动挂载 <code>disk.img</code>，然后将ArceOS 客户机镜像复制到该文件系统中即可</p>
<pre><code class="language-bash">$ mkdir -p tmp
$ sudo mount disk.img tmp
$ sudo cp /path/to/helloworld_riscv64-qemu-virt.bin tmp/
$ sudo umount tmp
</code></pre>
</li>
</ol>
</li>
<li>
<p>修改对应的 <code>./configs/vms/arceos-riscv64.toml</code> 文件中的配置项</p>
<pre><code class="language-toml">[kernel]
# The entry point of the kernel image.
entry_point = 0x8020_0000
# The location of image: "memory" | "fs".
# Load from file system.
image_location = "fs"
# The file path of the kernel image.
kernel_path = "/path/to/helloworld_riscv64-qemu-virt.bin"
# The load address of the kernel image.
kernel_load_addr = 0x8020_0000
</code></pre>
<ul>
<li><code>image_location="fs"</code> 表示从文件系统加载</li>
<li><code>kernel_path</code> 指出内核镜像在文件系统中的路径</li>
<li><code>entry_point</code> 指出内核镜像的入口地址。必须与上面构建的 ArceOS 内核镜像的入口地址一致</li>
<li><code>kernel_load_addr</code> 指出内核镜像的加载地址。默认与 <code>entry_point</code> 一致</li>
<li>其他</li>
</ul>
</li>
<li>
<p>执行 <code>make ACCEL=n ARCH=riscv64 LOG=info VM_CONFIGS=configs/vms/arceos-riscv64.toml FEATURES=page-alloc-64g APP_FEATURES=fs run</code> 构建 AxVisor，并在 QEMU 中启动。</p>
<pre><code class="language-plaintext">       d8888                            .d88888b.   .d8888b.
      d88888                           d88P" "Y88b d88P  Y88b
     d88P888                           888     888 Y88b.
    d88P 888 888d888  .d8888b  .d88b.  888     888  "Y888b.
   d88P  888 888P"   d88P"    d8P  Y8b 888     888     "Y88b.
  d88P   888 888     888      88888888 888     888       "888
 d8888888888 888     Y88b.    Y8b.     Y88b. .d88P Y88b  d88P
d88P     888 888      "Y8888P  "Y8888   "Y88888P"   "Y8888P"

arch = riscv64
platform = riscv64-qemu-virt
target = riscv64gc-unknown-none-elf
build_mode = release
log_level = info
smp = 1

[  0.029278 0 axruntime:139] Logging is enabled.
[  0.029991 0 axruntime:140] Primary CPU 0 started, dtb = 0x0.
[  0.030323 0 axruntime:142] Found physcial memory regions:
[  0.030872 0 axruntime:144]   [PA:0x80200000, PA:0x8026d000) .text (READ | EXECUTE | RESERVED)
[  0.031504 0 axruntime:144]   [PA:0x8026d000, PA:0x80286000) .rodata (READ | RESERVED)
[  0.031777 0 axruntime:144]   [PA:0x80286000, PA:0x80289000) .data .tdata .tbss .percpu (READ | WRITE | RESERVED)
[  0.032126 0 axruntime:144]   [PA:0x80289000, PA:0x802c9000) boot stack (READ | WRITE | RESERVED)
[  0.032423 0 axruntime:144]   [PA:0x802c9000, PA:0x804ed000) .bss (READ | WRITE | RESERVED)
[  0.032736 0 axruntime:144]   [PA:0x804ed000, PA:0x88000000) free memory (READ | WRITE | FREE)
[  0.033083 0 axruntime:144]   [PA:0x101000, PA:0x102000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.033393 0 axruntime:144]   [PA:0xc000000, PA:0xc210000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.033701 0 axruntime:144]   [PA:0x10000000, PA:0x10001000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.034025 0 axruntime:144]   [PA:0x10001000, PA:0x10009000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.034327 0 axruntime:144]   [PA:0x30000000, PA:0x40000000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.034629 0 axruntime:144]   [PA:0x40000000, PA:0x80000000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.034985 0 axruntime:226] Initialize global memory allocator...
[  0.035246 0 axruntime:227]   use TLSF allocator.
[  0.036774 0 axmm:72] Initialize virtual memory management...
[  0.060657 0 axruntime:159] Initialize platform devices...
[  0.060998 0 axtask::api:73] Initialize scheduling...
[  0.062593 0:2 axtask::api:79]   use FIFO scheduler.
[  0.063236 0:2 axdriver:172] Initialize device drivers...
[  0.063728 0:2 axdriver:173]   device model: static
[  0.067880 0:2 virtio_drivers::device::blk:59] config: 0xffffffc040006000
[  0.068333 0:2 virtio_drivers::device::blk:64] found a block device of size 65536KB
[  0.069105 0:2 axdriver::bus::pci:104] registered a new Block device at 00:01.0: "virtio-blk"
[  0.099971 0:2 axfs:41] Initialize filesystems...
[  0.100246 0:2 axfs:44]   use block device 0: "virtio-blk"
[  0.110023 0:2 fatfs::dir:139] Is a directory
[  0.117188 0:2 fatfs::dir:139] Is a directory
[  0.126339 0:2 fatfs::dir:139] Is a directory
[  0.135793 0:2 fatfs::dir:139] Is a directory
[  0.139893 0:2 axruntime:192] Initialize interrupt handlers...
[  0.140471 0:2 axruntime:204] Primary CPU 0 init OK.


    _         __     ___
   / \   __  _\ \   / (_)___  ___  _ __
  / _ \  \ \/ /\ \ / /| / __|/ _ \| '__|
 / ___ \  &gt;  &lt;  \ V / | \__ \ (_) | |
/_/   \_\/_/\_\  \_/  |_|___/\___/|_|


by AxVisor Team

[  0.141400 0:2 axvisor:21] Starting virtualization...
[  0.141663 0:2 axvisor:22] Hardware support: true
[  0.142729 0:4 axvisor::vmm::timer:101] Initing HV Timer...
[  0.143075 0:4 axvisor::hal:122] Hardware virtualization support enabled on core 0
[  0.156735 0:2 axvisor::vmm::config:33] Creating VM[1] "arceos"
[  0.157384 0:2 axvm::vm:114] Setting up memory region: [0x80000000~0x81000000] READ | WRITE | EXECUTE | USER
[  0.160395 0:2 axvm::vm:166] Setting up passthrough device memory region: [0xc000000~0xc210000] -&gt; [0xc000000~0xc210000]
[  0.161207 0:2 axvm::vm:166] Setting up passthrough device memory region: [0x10000000~0x10001000] -&gt; [0x10000000~0x10001000]
[  0.161736 0:2 axvm::vm:202] VM[1] created
[  0.162041 0:2 axvm::vm:217] VM[1] vcpus set up
[  0.162314 0:2 axvisor::vmm::config:40] VM[1] created success, loading images...
[  0.162628 0:2 axvisor::vmm::images::fs:153] Loading VM images from filesystem
[  0.168998 0:2 axvisor::vmm:35] Setting up vcpus...
[  0.169565 0:2 axvisor::vmm::vcpus:219] Initializing VM[1]'s 1 vcpus
[  0.169924 0:2 axvisor::vmm::vcpus:250] Spawning task for VM[1] VCpu[0]
[  0.170459 0:2 axvisor::vmm::vcpus:262] VCpu task Task(5, "VM[1]-VCpu[0]") created cpumask: [0, ]
[  0.170977 0:2 axvisor::vmm:43] VMM starting, booting VMs...
[  0.171295 0:2 axvm::vm:284] Booting VM[1]
[  0.171556 0:2 axvisor::vmm:49] VM[1] boot success
[  0.171856 0:2 axvisor::vmm:60] a VM exited, current running VM count: 1
[  0.172443 0:5 axvisor::vmm::vcpus:283] VM[1] VCpu[0] waiting for running
[  0.172806 0:5 axvisor::vmm::vcpus:286] VM[1] VCpu[0] running...
#��6���6Be#��6��65

                  e�q�/%5Eu��o@#0��0�\�4
���                                     ��7�I�c��7��D7ք4
�3
B�o�~4�B�#(4#*d#&lt;�#0T#4D#8#
                           ��E#�#8$#,#0$�h��}V���c��0�h�l���ŀ��ei���0�  P5
                                                                          �E/5��@N5
B�J4�B�E                                                                           *��ET���!E*���K!�N�E�����瀠�E
        �
$&amp;�$�#&lt;6�"  �� �##��/��}��#&lt;�Ec� ��)�2������/��}�����    �毵��/��}���
                                       �
                                        %�)�2�
                                              �
$&amp;�$�#&lt; �"  ��  ##��    �        ��)�2�        %��E������&amp;f�����p��Z�f
                                       �
                                        %�)�2�
                                              �
                                               %� 
$&amp;�$�#&lt;��"  ��f ##��    �        ��)�2�
                                       �
                                        %�)�2�
                                              �
                                               %�@݃U���� ��op
$&amp;�$�#&lt;��"  ���Z##��    �        ��)�2�
                                       �
                                        %�)�2�
                                              �
$&amp;�$�#&lt; �"  ��  ##��    �        ��)�2�        %��Fc����.����������p��Z�f
                                       �
                                        %�)�2�
                                              �
$&amp;�$�#&lt; �"  ��  ##��    �        ��)�2�        %�������������p��Z�f
                                       �
                                        %�)�2�
                                              �
$&amp;�$�#&lt; �"  ��  ##��    �        ��)�2��       %��Ś�Eca�����������E��
                                        %�)�2��
$&amp;�$�#&lt; �"  ��  ##��    �        ��)�2�        %������������������p��Z�f
                                       �
                                        %�)�2�
                                              �
$&amp;�$�#&lt; �"  ��  ##��    �        ��)�2�        %������������������p��Z�f
                                       �
                                        %�)�2�
                                              �
$&amp;�$�#&lt; �"  ��  ##��    �        ��)�2�        %������������������p��Z�f
                                       �
                                        %�)�2�
                                              �
$&amp;�$�#&lt; �"  ��  ##��    �        ��)�2�        %������������������p��Z�f
                                       �
                                        %�)�2�
                                              �
$&amp;�$�#&lt; �"  ��  ##��    �        ��)�2�        %������������������p��Z�f
                                       �
                                        %�)�2�
                                              �
$&amp;�$��{(�p�#&lt;�ݽ"ccݰ��   �        ����qU/ N�E���Fc�0���������������p��Z�f
$&amp;�$�.E�UaA��%%# �c�o0:����� �#�EA-�E1-F
</code></pre>
</li>
</ol>
<h3 id="从内存加载运行"><a class="header" href="#从内存加载运行">从内存加载运行</a></h3>
<p>获取 AxVisor 主线代码 <code>git clone git@github.com:arceos-hypervisor/axvisor.git</code>，然后在 <code>axvisor</code> 源码目录中执行如下步骤：</p>
<ol>
<li>
<p>修改对应的 <code>./configs/vms/arceos-riscv64.toml</code> 中的配置项</p>
<pre><code class="language-toml">[kernel]
# The entry point of the kernel image.
entry_point = 0x8020_0000
# The location of image: "memory" | "fs".
# Load from file system.
image_location = "memory"
# The file path of the kernel image.
kernel_path = "/path/to/helloworld_riscv64-qemu-virt.bin"
# The load address of the kernel image.
kernel_load_addr = 0x8020_0000
</code></pre>
<ul>
<li><code>image_location="memory"</code> 配置项</li>
<li><code>kernel_path</code> 指定内核镜像在工作空间中的相对/绝对路径</li>
<li><code>entry_point</code> 指出内核镜像的入口地址。必须与上面构建的 ArceOS 内核镜像的入口地址一致</li>
<li><code>kernel_load_addr</code> 指出内核镜像的加载地址。默认与 <code>entry_point</code> 一致</li>
<li>其他</li>
</ul>
</li>
<li>
<p>执行 <code>make ACCEL=n ARCH=riscv64 LOG=info VM_CONFIGS=configs/vms/arceos-riscv64.toml FEATURES=page-alloc-64g run</code> 构建 AxVisor，并在 QEMU 中启动。</p>
<pre><code class="language-plaintext">       d8888                            .d88888b.   .d8888b.
      d88888                           d88P" "Y88b d88P  Y88b
     d88P888                           888     888 Y88b.
    d88P 888 888d888  .d8888b  .d88b.  888     888  "Y888b.
   d88P  888 888P"   d88P"    d8P  Y8b 888     888     "Y88b.
  d88P   888 888     888      88888888 888     888       "888
 d8888888888 888     Y88b.    Y8b.     Y88b. .d88P Y88b  d88P
d88P     888 888      "Y8888P  "Y8888   "Y88888P"   "Y8888P"

arch = riscv64
platform = riscv64-qemu-virt
target = riscv64gc-unknown-none-elf
build_mode = release
log_level = info
smp = 1

[  0.033033 0 axruntime:139] Logging is enabled.
[  0.033974 0 axruntime:140] Primary CPU 0 started, dtb = 0x0.
[  0.034529 0 axruntime:142] Found physcial memory regions:
[  0.035069 0 axruntime:144]   [PA:0x80200000, PA:0x80251000) .text (READ | EXECUTE | RESERVED)
[  0.035833 0 axruntime:144]   [PA:0x80251000, PA:0x8026b000) .rodata (READ | RESERVED)
[  0.036372 0 axruntime:144]   [PA:0x8026b000, PA:0x8026e000) .data .tdata .tbss .percpu (READ | WRITE | RESERVED)
[  0.036997 0 axruntime:144]   [PA:0x8026e000, PA:0x802ae000) boot stack (READ | WRITE | RESERVED)
[  0.037600 0 axruntime:144]   [PA:0x802ae000, PA:0x804d2000) .bss (READ | WRITE | RESERVED)
[  0.038160 0 axruntime:144]   [PA:0x804d2000, PA:0x88000000) free memory (READ | WRITE | FREE)
[  0.038748 0 axruntime:144]   [PA:0x101000, PA:0x102000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.039305 0 axruntime:144]   [PA:0xc000000, PA:0xc210000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.039852 0 axruntime:144]   [PA:0x10000000, PA:0x10001000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.040411 0 axruntime:144]   [PA:0x10001000, PA:0x10009000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.040965 0 axruntime:144]   [PA:0x30000000, PA:0x40000000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.041552 0 axruntime:144]   [PA:0x40000000, PA:0x80000000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.042200 0 axruntime:226] Initialize global memory allocator...
[  0.042633 0 axruntime:227]   use TLSF allocator.
[  0.044301 0 axmm:72] Initialize virtual memory management...
[  0.068855 0 axruntime:159] Initialize platform devices...
[  0.069350 0 axtask::api:73] Initialize scheduling...
[  0.070532 0:2 axtask::api:79]   use FIFO scheduler.
[  0.071083 0:2 axruntime:192] Initialize interrupt handlers...
[  0.071811 0:2 axruntime:204] Primary CPU 0 init OK.


       d8888            888     888  d8b
      d88888            888     888  Y8P
     d88P888            888     888
    d88P 888  888  888  Y88b   d88P  888  .d8888b    .d88b.   888d888
   d88P  888  `Y8bd8P'   Y88b d88P   888  88K       d88""88b  888P"
  d88P   888    X88K      Y88o88P    888  "Y8888b.  888  888  888
 d8888888888  .d8""8b.     Y888P     888       X88  Y88..88P  888
d88P     888  888  888      Y8P      888   88888P'   "Y88P"   888


by AxVisor Team

[  0.074159 0:2 axvisor:21] Starting virtualization...
[  0.074645 0:2 axvisor:22] Hardware support: true
[  0.075869 0:4 axvisor::vmm::timer:101] Initing HV Timer...
[  0.076362 0:4 axvisor::hal:122] Hardware virtualization support enabled on core 0
[  0.090502 0:2 axvisor::vmm::config:33] Creating VM[1] "arceos"
[  0.091340 0:2 axvm::vm:114] Setting up memory region: [0x80000000~0x81000000] READ | WRITE | EXECUTE | USER
[  0.094702 0:2 axvm::vm:166] Setting up passthrough device memory region: [0xc000000~0xc210000] -&gt; [0xc000000~0xc210000]
[  0.095782 0:2 axvm::vm:166] Setting up passthrough device memory region: [0x10000000~0x10001000] -&gt; [0x10000000~0x10001000]
[  0.096655 0:2 axvm::vm:202] VM[1] created
[  0.097141 0:2 axvm::vm:217] VM[1] vcpus set up
[  0.097558 0:2 axvisor::vmm::config:40] VM[1] created success, loading images...
[  0.098164 0:2 axvisor::vmm::images:49] Loading VM[1] images from memory
[  0.099431 0:2 axvisor::vmm:35] Setting up vcpus...
[  0.100145 0:2 axvisor::vmm::vcpus:219] Initializing VM[1]'s 1 vcpus
[  0.100708 0:2 axvisor::vmm::vcpus:250] Spawning task for VM[1] VCpu[0]
[  0.101450 0:2 axvisor::vmm::vcpus:262] VCpu task Task(5, "VM[1]-VCpu[0]") created cpumask: [0, ]
[  0.102281 0:2 axvisor::vmm:43] VMM starting, booting VMs...
[  0.102764 0:2 axvm::vm:284] Booting VM[1]
[  0.103172 0:2 axvisor::vmm:49] VM[1] boot success
[  0.103630 0:2 axvisor::vmm:60] a VM exited, current running VM count: 1
[  0.104392 0:5 axvisor::vmm::vcpus:283] VM[1] VCpu[0] waiting for running
[  0.104955 0:5 axvisor::vmm::vcpus:286] VM[1] VCpu[0] running...
���2�#0�*#4�*���2�#8�*�J#&lt;Q+�
f
 2�#0�,�,�
          2��*�#4�,#8�,#&lt;A-����#0�.-E#4�.6�#8�.:�#&lt;�.#0�0����#4q0�*�#8�0; �
                                                                           �M   �IL��%�)#4�K�v#8�J#&lt;1K�f�#4�LF#8�L0#&lt;�L#0QO�#4�N#8QO#&lt;F6v#&lt;�Hp#0�J�I#0�L�q#0�H#41I#8H��G��s�uŕEc����
�Lu}�ct�Jc�څúL��-G�.��v:v&amp;�                                                                                                                                                       ���c�
t3��Aae���G�0.�������Zu5�&lt;�k��6�#&lt;�D�
�#0�C#8�%                            #&lt;�2%�Q#0�4��E#4�4#8�4�#&lt;�4ve#0�6�#4�6���%�#8�6#&lt;�7#4�9#&lt;8E#Fc
         ��e0c  ��%���
Fba�yo&amp;�E�������f#&lt;�&amp;�0ba�yo�,�#&lt;�,%E#0�.���%L##� �p����JQ����E*���*�����j����#0�"%G#&lt;��*�#0�*�#0
</code></pre>
</li>
</ol>
<h2 id="nimbos"><a class="header" href="#nimbos">NimbOS</a></h2>
<h3 id="准备-nimbos-镜像"><a class="header" href="#准备-nimbos-镜像">准备 NimbOS 镜像</a></h3>
<p><a href="https://github.com/arceos-hypervisor/nimbos">NimbOS</a> 仓库的 <a href="https://github.com/arceos-hypervisor/nimbos/releases/">release</a> 页面已经编译生成了可以直接运行的 NimbOS 二进制镜像文件压缩包：</p>
<ul>
<li>不带 <code>_usertests</code> 后缀的 NimbOS 二进制镜像包中编译的 NimbOS 启动后会进入 NimbOS 的 shell，本示例启动的就是这个 NimbOS</li>
<li>带 <code>usertests</code> 后缀的 NimbOS 二进制镜像压缩包中编译的 NimbOS 启动后会自动运行用户态测例用于测试，这个镜像用于 AxVisor 的CI测试，见 <a href="https://github.com/arceos-hypervisor/axvisor/blob/master/.github/workflows/actions/setup-nimbos-guest-image/action.yml">setup-nimbos-guest-image/action.yml</a></li>
</ul>
<h3 id="从文件系统加载运行-1"><a class="header" href="#从文件系统加载运行-1">从文件系统加载运行</a></h3>
<p>获取 AxVisor 主线代码 <code>git clone git@github.com:arceos-hypervisor/axvisor.git</code>，然后在 <code>axvisor</code> 源码目录中执行如下步骤：</p>
<ol>
<li>
<p>制作一个磁盘镜像文件，并将客户机镜像放到文件系统中</p>
<ol>
<li>
<p>使用 <code>make disk_img</code> 命令生成一个空的 FAT32 磁盘镜像文件 <code>disk.img</code></p>
</li>
<li>
<p>手动挂载 <code>disk.img</code>，然后拉取并解压二进制镜像</p>
<pre><code class="language-bash">$ mkdir -p tmp
$ sudo mount disk.img tmp
$ wget https://github.com/arceos-hypervisor/nimbos/releases/download/v0.7/riscv64.zip
$ unzip riscv64.zip # 得到 nimbos.bin
$ sudo mv nimbos.bin tmp/nimbos-riscv64.bin
$ sudo umount tmp
</code></pre>
</li>
</ol>
</li>
<li>
<p>直接使用 <a href="https://github.com/arceos-hypervisor/axvisor/blob/master/configs/vms/nimbos-riscv64.toml"><code>configs/vms/nimbos-riscv64.toml</code></a> 文件中的配置项</p>
<ul>
<li><code>image_location="fs"</code> 表示从文件系统加载</li>
<li><code>kernel_path</code> 指出内核镜像在文件系统中的路径</li>
<li><code>entry_point</code> 指出内核镜像的入口地址。必须与上面构建的 ArceOS 内核镜像的入口地址一致</li>
<li><code>kernel_load_addr</code> 指出内核镜像的加载地址。默认与 <code>entry_point</code> 一致</li>
<li>其他</li>
</ul>
</li>
<li>
<p>执行 <code>make ACCEL=n ARCH=riscv64 LOG=info VM_CONFIGS=configs/vms/nimbos-riscv64.toml FEATURES=page-alloc-64g APP_FEATURES=fs defconfig</code> 创建 <code>.axconfig.toml</code> 配置文件</p>
</li>
<li>
<p>执行 <code>make ACCEL=n ARCH=riscv64 LOG=info VM_CONFIGS=configs/vms/nimbos-riscv64.toml FEATURES=page-alloc-64g APP_FEATURES=fs run</code> 构建 AxVisor，并在 QEMU 中启动。</p>
<pre><code class="language-plaintext">qemu-system-riscv64 -m 4G -smp 1 -machine virt -bios default -kernel /code/new/axvisor/axvisor_riscv64-qemu-virt.bin -device virtio-blk-pci,drive=disk0 -drive id=disk0,if=none,format=raw,file=disk.img -nographic

OpenSBI v1.3
   ____                    _____ ____ _____
  / __ \                  / ____|  _ \_   _|
 | |  | |_ __   ___ _ __ | (___ | |_) || |
 | |  | | '_ \ / _ \ '_ \ \___ \|  _ &lt; | |
 | |__| | |_) |  __/ | | |____) | |_) || |_
  \____/| .__/ \___|_| |_|_____/|___/_____|
        | |
        |_|

Platform Name             : riscv-virtio,qemu
Platform Features         : medeleg
Platform HART Count       : 1
Platform IPI Device       : aclint-mswi
Platform Timer Device     : aclint-mtimer @ 10000000Hz
Platform Console Device   : uart8250
Platform HSM Device       : ---
Platform PMU Device       : ---
Platform Reboot Device    : sifive_test
Platform Shutdown Device  : sifive_test
Platform Suspend Device   : ---
Platform CPPC Device      : ---
Firmware Base             : 0x80000000
Firmware Size             : 322 KB
Firmware RW Offset        : 0x40000
Firmware RW Size          : 66 KB
Firmware Heap Offset      : 0x48000
Firmware Heap Size        : 34 KB (total), 2 KB (reserved), 9 KB (used), 22 KB (free)
Firmware Scratch Size     : 4096 B (total), 760 B (used), 3336 B (free)
Runtime SBI Version       : 1.0

Domain0 Name              : root
Domain0 Boot HART         : 0
Domain0 HARTs             : 0*
Domain0 Region00          : 0x0000000002000000-0x000000000200ffff M: (I,R,W) S/U: ()
Domain0 Region01          : 0x0000000080040000-0x000000008005ffff M: (R,W) S/U: ()
Domain0 Region02          : 0x0000000080000000-0x000000008003ffff M: (R,X) S/U: ()
Domain0 Region03          : 0x0000000000000000-0xffffffffffffffff M: (R,W,X) S/U: (R,W,X)
Domain0 Next Address      : 0x0000000080200000
Domain0 Next Arg1         : 0x00000000bfe00000
Domain0 Next Mode         : S-mode
Domain0 SysReset          : yes
Domain0 SysSuspend        : yes

Boot HART ID              : 0
Boot HART Domain          : root
Boot HART Priv Version    : v1.12
Boot HART Base ISA        : rv64imafdch
Boot HART ISA Extensions  : time,sstc
Boot HART PMP Count       : 16
Boot HART PMP Granularity : 4
Boot HART PMP Address Bits: 54
Boot HART MHPM Count      : 16
Boot HART MIDELEG         : 0x0000000000001666
Boot HART MEDELEG         : 0x0000000000f0b509

       d8888                            .d88888b.   .d8888b.
      d88888                           d88P" "Y88b d88P  Y88b
     d88P888                           888     888 Y88b.
    d88P 888 888d888  .d8888b  .d88b.  888     888  "Y888b.
   d88P  888 888P"   d88P"    d8P  Y8b 888     888     "Y88b.
  d88P   888 888     888      88888888 888     888       "888
 d8888888888 888     Y88b.    Y8b.     Y88b. .d88P Y88b  d88P
d88P     888 888      "Y8888P  "Y8888   "Y88888P"   "Y8888P"

arch = riscv64
platform = riscv64-qemu-virt
target = riscv64gc-unknown-none-elf
build_mode = release
log_level = info
smp = 1

[  0.028791 0 axruntime:139] Logging is enabled.
[  0.029501 0 axruntime:140] Primary CPU 0 started, dtb = 0x0.
[  0.029828 0 axruntime:142] Found physcial memory regions:
[  0.030204 0 axruntime:144]   [PA:0x80200000, PA:0x8026d000) .text (READ | EXECUTE | RESERVED)
[  0.030682 0 axruntime:144]   [PA:0x8026d000, PA:0x80286000) .rodata (READ | RESERVED)
[  0.030992 0 axruntime:144]   [PA:0x80286000, PA:0x80289000) .data .tdata .tbss .percpu (READ | WRITE | RESERVED)
[  0.031321 0 axruntime:144]   [PA:0x80289000, PA:0x802c9000) boot stack (READ | WRITE | RESERVED)
[  0.031626 0 axruntime:144]   [PA:0x802c9000, PA:0x804ed000) .bss (READ | WRITE | RESERVED)
[  0.031943 0 axruntime:144]   [PA:0x804ed000, PA:0x88000000) free memory (READ | WRITE | FREE)
[  0.032269 0 axruntime:144]   [PA:0x101000, PA:0x102000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.032566 0 axruntime:144]   [PA:0xc000000, PA:0xc210000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.032859 0 axruntime:144]   [PA:0x10000000, PA:0x10001000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.033155 0 axruntime:144]   [PA:0x10001000, PA:0x10009000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.033483 0 axruntime:144]   [PA:0x30000000, PA:0x40000000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.033778 0 axruntime:144]   [PA:0x40000000, PA:0x80000000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.034125 0 axruntime:226] Initialize global memory allocator...
[  0.034382 0 axruntime:227]   use TLSF allocator.
[  0.035886 0 axmm:72] Initialize virtual memory management...
[  0.059650 0 axruntime:159] Initialize platform devices...
[  0.059981 0 axtask::api:73] Initialize scheduling...
[  0.061045 0:2 axtask::api:79]   use FIFO scheduler.
[  0.061406 0:2 axdriver:172] Initialize device drivers...
[  0.061668 0:2 axdriver:173]   device model: static
[  0.065304 0:2 virtio_drivers::device::blk:59] config: 0xffffffc040006000
[  0.065747 0:2 virtio_drivers::device::blk:64] found a block device of size 65536KB
[  0.066567 0:2 axdriver::bus::pci:104] registered a new Block device at 00:01.0: "virtio-blk"
[  0.096997 0:2 axfs:41] Initialize filesystems...
[  0.097260 0:2 axfs:44]   use block device 0: "virtio-blk"
[  0.107167 0:2 fatfs::dir:139] Is a directory
[  0.114616 0:2 fatfs::dir:139] Is a directory
[  0.124030 0:2 fatfs::dir:139] Is a directory
[  0.133590 0:2 fatfs::dir:139] Is a directory
[  0.137773 0:2 axruntime:192] Initialize interrupt handlers...
[  0.138349 0:2 axruntime:204] Primary CPU 0 init OK.


    _         __     ___
   / \   __  _\ \   / (_)___  ___  _ __
  / _ \  \ \/ /\ \ / /| / __|/ _ \| '__|
 / ___ \  &gt;  &lt;  \ V / | \__ \ (_) | |
/_/   \_\/_/\_\  \_/  |_|___/\___/|_|


by AxVisor Team

[  0.139243 0:2 axvisor:21] Starting virtualization...
[  0.139504 0:2 axvisor:22] Hardware support: true
[  0.140719 0:4 axvisor::vmm::timer:101] Initing HV Timer...
[  0.141091 0:4 axvisor::hal:122] Hardware virtualization support enabled on core 0
[  0.154782 0:2 axvisor::vmm::config:33] Creating VM[1] "nimbos"
[  0.155608 0:2 axvm::vm:114] Setting up memory region: [0x90000000~0x91000000] READ | WRITE | EXECUTE | USER
[  0.158804 0:2 axvm::vm:166] Setting up passthrough device memory region: [0xc000000~0xc210000] -&gt; [0xc000000~0xc210000]
[  0.159618 0:2 axvm::vm:166] Setting up passthrough device memory region: [0x10000000~0x10001000] -&gt; [0x10000000~0x10001000]
[  0.160212 0:2 axvm::vm:202] VM[1] created
[  0.160527 0:2 axvm::vm:217] VM[1] vcpus set up
[  0.160803 0:2 axvisor::vmm::config:40] VM[1] created success, loading images...
[  0.161133 0:2 axvisor::vmm::images::fs:153] Loading VM images from filesystem
[  0.211299 0:2 axvisor::vmm:35] Setting up vcpus...
[  0.211971 0:2 axvisor::vmm::vcpus:219] Initializing VM[1]'s 1 vcpus
[  0.212344 0:2 axvisor::vmm::vcpus:250] Spawning task for VM[1] VCpu[0]
[  0.212914 0:2 axvisor::vmm::vcpus:262] VCpu task Task(5, "VM[1]-VCpu[0]") created cpumask: [0, ]
[  0.213460 0:2 axvisor::vmm:43] VMM starting, booting VMs...
[  0.213842 0:2 axvm::vm:284] Booting VM[1]
[  0.214197 0:2 axvisor::vmm:49] VM[1] boot success
[  0.214614 0:2 axvisor::vmm:60] a VM exited, current running VM count: 1
[  0.215355 0:5 axvisor::vmm::vcpus:283] VM[1] VCpu[0] waiting for running
[  0.215844 0:5 axvisor::vmm::vcpus:286] VM[1] VCpu[0] running...

NN   NN  iii               bb        OOOOO    SSSSS
NNN  NN       mm mm mmmm   bb       OO   OO  SS
NN N NN  iii  mmm  mm  mm  bbbbbb   OO   OO   SSSSS
NN  NNN  iii  mmm  mm  mm  bb   bb  OO   OO       SS
NN   NN  iii  mmm  mm  mm  bbbbbb    OOOO0    SSSSS
              ___    ____    ___    ___
             |__ \  / __ \  |__ \  |__ \
             __/ / / / / /  __/ /  __/ /
            / __/ / /_/ /  / __/  / __/
           /____/ \____/  /____/ /____/

arch = riscv64
platform = qemu-virt-riscv
build_mode = release
log_level = warn

Initializing kernel heap at: [0xffffffc0902920a8, 0xffffffc0906920a8)
Initializing frame allocator at: [PA:0x90693000, PA:0x98000000)
Mapping .text: [0xffffffc090200000, 0xffffffc090210000)
Mapping .rodata: [0xffffffc090210000, 0xffffffc090217000)
Mapping .data: [0xffffffc090217000, 0xffffffc09028e000)
Mapping .bss: [0xffffffc090292000, 0xffffffc090693000)
Mapping boot stack: [0xffffffc09028e000, 0xffffffc090292000)
Mapping physical memory: [0xffffffc090693000, 0xffffffc098000000)
Mapping MMIO: [0xffffffc00c000000, 0xffffffc00c210000)
Mapping MMIO: [0xffffffc010000000, 0xffffffc010001000)
Initializing drivers...
Initializing task manager...
/**** APPS ****
cyclictest
exit
fantastic_text
forktest
forktest2
forktest_simple
forktest_simple_c
forktree
hello_c
hello_world
matrix
poweroff
sleep
sleep_simple
stack_overflow
thread_simple
user_shell
usertests
yield
**************/
Running tasks...
test kernel task: pid = TaskId(2), arg = 0xdead
test kernel task: pid = TaskId(3), arg = 0xbeef
Rust user shell
&gt;&gt; 
</code></pre>
</li>
</ol>
<h3 id="从内存中加载运行"><a class="header" href="#从内存中加载运行">从内存中加载运行</a></h3>
<ul>
<li>
<p>获取 AxVisor 主线代码 <code>git clone git@github.com:arceos-hypervisor/axvisor.git</code>，然后在 <code>axvisor</code> 源码目录中执行如下步骤：</p>
<ol>
<li>
<p>修改对应的 <code>./configs/vms/nimbos-riscv64.toml</code> 中的配置项，注意设置 <code>kernel_path</code>  和 <code>bios_path</code> 为 nimbos 二进制内核镜像在工作空间中的相对/绝对路径</p>
<pre><code class="language-toml">[kernel]
# The entry point of the kernel image.
entry_point = 0x9020_0000
# The location of image: "memory" | "fs".
# Load from file system.
image_location = "memory"
# The file path of the kernel image.
kernel_path = "nimbos.bin"
# The load address of the kernel image.
kernel_load_addr = 0x9020_0000
</code></pre>
<ul>
<li><code>image_location="memory"</code> 配置项</li>
<li><code>kernel_path</code> 指定内核镜像在工作空间中的相对/绝对路径</li>
<li><code>entry_point</code> 指出内核镜像的入口地址。必须与上面构建的 ArceOS 内核镜像的入口地址一致</li>
<li><code>kernel_load_addr</code> 指出内核镜像的加载地址。默认与 <code>entry_point</code> 一致</li>
<li><code>bios_path</code> 可通过 <a href="https://github.com/arceos-hypervisor/axvm-bios-x86/releases/download/v0.1/axvm-bios.bin">链接</a> 直接下载，或参考 riscv64 用户虚拟机的极简BIOS实现 <a href="https://github.com/arceos-hypervisor/axvm-bios-x86">axvm-bios</a></li>
<li><code>bios_load_addr</code> 指出 bios 镜像的加载地址，默认为  0x8000</li>
<li>其他</li>
</ul>
</li>
<li>
<p>执行 <code>make ACCEL=n ARCH=riscv64 LOG=info VM_CONFIGS=configs/vms/nimbos-riscv64.toml FEATURES=page-alloc-64g run</code> 构建 AxVisor，并在 QEMU 中启动。</p>
<pre><code class="language-plaintext">qemu-system-riscv64 -m 4G -smp 1 -machine virt -bios default -kernel /code/new/axvisor/axvisor_riscv64-qemu-virt.bin -device virtio-blk-pci,drive=disk0 -drive id=disk0,if=none,format=raw,file=disk.img -nographic

OpenSBI v1.3
   ____                    _____ ____ _____
  / __ \                  / ____|  _ \_   _|
 | |  | |_ __   ___ _ __ | (___ | |_) || |
 | |  | | '_ \ / _ \ '_ \ \___ \|  _ &lt; | |
 | |__| | |_) |  __/ | | |____) | |_) || |_
  \____/| .__/ \___|_| |_|_____/|___/_____|
        | |
        |_|

Platform Name             : riscv-virtio,qemu
Platform Features         : medeleg
Platform HART Count       : 1
Platform IPI Device       : aclint-mswi
Platform Timer Device     : aclint-mtimer @ 10000000Hz
Platform Console Device   : uart8250
Platform HSM Device       : ---
Platform PMU Device       : ---
Platform Reboot Device    : sifive_test
Platform Shutdown Device  : sifive_test
Platform Suspend Device   : ---
Platform CPPC Device      : ---
Firmware Base             : 0x80000000
Firmware Size             : 322 KB
Firmware RW Offset        : 0x40000
Firmware RW Size          : 66 KB
Firmware Heap Offset      : 0x48000
Firmware Heap Size        : 34 KB (total), 2 KB (reserved), 9 KB (used), 22 KB (free)
Firmware Scratch Size     : 4096 B (total), 760 B (used), 3336 B (free)
Runtime SBI Version       : 1.0

Domain0 Name              : root
Domain0 Boot HART         : 0
Domain0 HARTs             : 0*
Domain0 Region00          : 0x0000000002000000-0x000000000200ffff M: (I,R,W) S/U: ()
Domain0 Region01          : 0x0000000080040000-0x000000008005ffff M: (R,W) S/U: ()
Domain0 Region02          : 0x0000000080000000-0x000000008003ffff M: (R,X) S/U: ()
Domain0 Region03          : 0x0000000000000000-0xffffffffffffffff M: (R,W,X) S/U: (R,W,X)
Domain0 Next Address      : 0x0000000080200000
Domain0 Next Arg1         : 0x00000000bfe00000
Domain0 Next Mode         : S-mode
Domain0 SysReset          : yes
Domain0 SysSuspend        : yes

Boot HART ID              : 0
Boot HART Domain          : root
Boot HART Priv Version    : v1.12
Boot HART Base ISA        : rv64imafdch
Boot HART ISA Extensions  : time,sstc
Boot HART PMP Count       : 16
Boot HART PMP Granularity : 4
Boot HART PMP Address Bits: 54
Boot HART MHPM Count      : 16
Boot HART MIDELEG         : 0x0000000000001666
Boot HART MEDELEG         : 0x0000000000f0b509

       d8888                            .d88888b.   .d8888b.
      d88888                           d88P" "Y88b d88P  Y88b
     d88P888                           888     888 Y88b.
    d88P 888 888d888  .d8888b  .d88b.  888     888  "Y888b.
   d88P  888 888P"   d88P"    d8P  Y8b 888     888     "Y88b.
  d88P   888 888     888      88888888 888     888       "888
 d8888888888 888     Y88b.    Y8b.     Y88b. .d88P Y88b  d88P
d88P     888 888      "Y8888P  "Y8888   "Y88888P"   "Y8888P"

arch = riscv64
platform = riscv64-qemu-virt
target = riscv64gc-unknown-none-elf
build_mode = release
log_level = info
smp = 1

[  0.029128 0 axruntime:139] Logging is enabled.
[  0.029882 0 axruntime:140] Primary CPU 0 started, dtb = 0x0.
[  0.030274 0 axruntime:142] Found physcial memory regions:
[  0.030696 0 axruntime:144]   [PA:0x80200000, PA:0x80251000) .text (READ | EXECUTE | RESERVED)
[  0.031218 0 axruntime:144]   [PA:0x80251000, PA:0x802ef000) .rodata (READ | RESERVED)
[  0.031503 0 axruntime:144]   [PA:0x802ef000, PA:0x802f2000) .data .tdata .tbss .percpu (READ | WRITE | RESERVED)
[  0.031857 0 axruntime:144]   [PA:0x802f2000, PA:0x80332000) boot stack (READ | WRITE | RESERVED)
[  0.032161 0 axruntime:144]   [PA:0x80332000, PA:0x80556000) .bss (READ | WRITE | RESERVED)
[  0.032476 0 axruntime:144]   [PA:0x80556000, PA:0x88000000) free memory (READ | WRITE | FREE)
[  0.032835 0 axruntime:144]   [PA:0x101000, PA:0x102000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.033141 0 axruntime:144]   [PA:0xc000000, PA:0xc210000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.033443 0 axruntime:144]   [PA:0x10000000, PA:0x10001000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.033788 0 axruntime:144]   [PA:0x10001000, PA:0x10009000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.034118 0 axruntime:144]   [PA:0x30000000, PA:0x40000000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.034440 0 axruntime:144]   [PA:0x40000000, PA:0x80000000) mmio (READ | WRITE | DEVICE | RESERVED)
[  0.034835 0 axruntime:226] Initialize global memory allocator...
[  0.035089 0 axruntime:227]   use TLSF allocator.
[  0.036595 0 axmm:72] Initialize virtual memory management...
[  0.060733 0 axruntime:159] Initialize platform devices...
[  0.061072 0 axtask::api:73] Initialize scheduling...
[  0.061923 0:2 axtask::api:79]   use FIFO scheduler.
[  0.062288 0:2 axruntime:192] Initialize interrupt handlers...
[  0.062840 0:2 axruntime:204] Primary CPU 0 init OK.


    _         __     ___
   / \   __  _\ \   / (_)___  ___  _ __
  / _ \  \ \/ /\ \ / /| / __|/ _ \| '__|
 / ___ \  &gt;  &lt;  \ V / | \__ \ (_) | |
/_/   \_\/_/\_\  \_/  |_|___/\___/|_|


by AxVisor Team

[  0.063905 0:2 axvisor:21] Starting virtualization...
[  0.064163 0:2 axvisor:22] Hardware support: true
[  0.065268 0:4 axvisor::vmm::timer:101] Initing HV Timer...
[  0.065612 0:4 axvisor::hal:122] Hardware virtualization support enabled on core 0
[  0.080076 0:2 axvisor::vmm::config:33] Creating VM[1] "nimbos"
[  0.080732 0:2 axvm::vm:114] Setting up memory region: [0x90000000~0x91000000] READ | WRITE | EXECUTE | USER
[  0.083726 0:2 axvm::vm:166] Setting up passthrough device memory region: [0xc000000~0xc210000] -&gt; [0xc000000~0xc210000]
[  0.084622 0:2 axvm::vm:166] Setting up passthrough device memory region: [0x10000000~0x10001000] -&gt; [0x10000000~0x10001000]
[  0.085274 0:2 axvm::vm:202] VM[1] created
[  0.085570 0:2 axvm::vm:217] VM[1] vcpus set up
[  0.085875 0:2 axvisor::vmm::config:40] VM[1] created success, loading images...
[  0.086337 0:2 axvisor::vmm::images:49] Loading VM[1] images from memory
[  0.087756 0:2 axvisor::vmm:35] Setting up vcpus...
[  0.088338 0:2 axvisor::vmm::vcpus:219] Initializing VM[1]'s 1 vcpus
[  0.088714 0:2 axvisor::vmm::vcpus:250] Spawning task for VM[1] VCpu[0]
[  0.089229 0:2 axvisor::vmm::vcpus:262] VCpu task Task(5, "VM[1]-VCpu[0]") created cpumask: [0, ]
[  0.089767 0:2 axvisor::vmm:43] VMM starting, booting VMs...
[  0.090118 0:2 axvm::vm:284] Booting VM[1]
[  0.090381 0:2 axvisor::vmm:49] VM[1] boot success
[  0.090687 0:2 axvisor::vmm:60] a VM exited, current running VM count: 1
[  0.091268 0:5 axvisor::vmm::vcpus:283] VM[1] VCpu[0] waiting for running
[  0.091643 0:5 axvisor::vmm::vcpus:286] VM[1] VCpu[0] running...

NN   NN  iii               bb        OOOOO    SSSSS
NNN  NN       mm mm mmmm   bb       OO   OO  SS
NN N NN  iii  mmm  mm  mm  bbbbbb   OO   OO   SSSSS
NN  NNN  iii  mmm  mm  mm  bb   bb  OO   OO       SS
NN   NN  iii  mmm  mm  mm  bbbbbb    OOOO0    SSSSS
              ___    ____    ___    ___
             |__ \  / __ \  |__ \  |__ \
             __/ / / / / /  __/ /  __/ /
            / __/ / /_/ /  / __/  / __/
           /____/ \____/  /____/ /____/

arch = riscv64
platform = qemu-virt-riscv
build_mode = release
log_level = warn

Initializing kernel heap at: [0xffffffc0902920a8, 0xffffffc0906920a8)
Initializing frame allocator at: [PA:0x90693000, PA:0x98000000)
Mapping .text: [0xffffffc090200000, 0xffffffc090210000)
Mapping .rodata: [0xffffffc090210000, 0xffffffc090217000)
Mapping .data: [0xffffffc090217000, 0xffffffc09028e000)
Mapping .bss: [0xffffffc090292000, 0xffffffc090693000)
Mapping boot stack: [0xffffffc09028e000, 0xffffffc090292000)
Mapping physical memory: [0xffffffc090693000, 0xffffffc098000000)
Mapping MMIO: [0xffffffc00c000000, 0xffffffc00c210000)
Mapping MMIO: [0xffffffc010000000, 0xffffffc010001000)
Initializing drivers...
Initializing task manager...
/**** APPS ****
cyclictest
exit
fantastic_text
forktest
forktest2
forktest_simple
forktest_simple_c
forktree
hello_c
hello_world
matrix
poweroff
sleep
sleep_simple
stack_overflow
thread_simple
user_shell
usertests
yield
**************/
Running tasks...
test kernel task: pid = TaskId(2), arg = 0xdead
test kernel task: pid = TaskId(3), arg = 0xbeef
Rust user shell
&gt;&gt; 
</code></pre>
</li>
</ol>
</li>
</ul>
<style>.scroll-to-top { font-size: 2.5rem; width: 3.2rem; height: 3.2rem; display: none; align-items: center; justify-content: center; position: fixed; padding: 0.75rem; bottom: 4rem; right: calc(1.25rem + 90px + var(--page-padding)); z-index: 999; cursor: pointer; border: none; color: var(--bg); background: var(--fg); border-radius: 50%; } .scroll-to-top.hidden { display: none; } .scroll-to-top i { transform: translateY(-2px); } @media (min-width: 1080px) { .scroll-to-top { display: flex; } }</style><button type="button" aria-label="scroll-to-top" class="scroll-to-top hidden" onclick="scrollToTop()"> <i class="fa fa-angle-up"></i></button><script>const scrollToTop = () => window.scroll({ top: 0, behavior: "smooth" }); window.addEventListener("scroll", () => { const button = document.querySelector(".scroll-to-top"); button.classList.toggle("hidden", window.scrollY <200); });</script><style>.announcement-banner { --site-announcement-bar-stripe-color1: #e5e7eb; --site-announcement-bar-stripe-color2: #d1d5db; z-index: 150; position: relative; flex-direction: column; justify-content: center; align-items: center; margin: 0; padding: 1rem 3.5rem; background: repeating-linear-gradient( 45deg, var(--site-announcement-bar-stripe-color1), var(--site-announcement-bar-stripe-color1) 20px, var(--site-announcement-bar-stripe-color2) 10px, var(--site-announcement-bar-stripe-color2) 40px ); } html:is(.navy, .coal, .ayu) .announcement-banner { --site-announcement-bar-stripe-color1: #1f2937; --site-announcement-bar-stripe-color2: #111827; } .announcement-banner p { color: var(--fg); width: 100%; margin: 0; padding: 0; overflow: hidden; text-align: center; white-space: nowrap; text-overflow: ellipsis; text-wrap: balance; } .announcement-banner button[data-close] { top: 50%; right: 1rem; position: absolute; transform: translateY(-50%); width: 3rem; height: 3rem; cursor: pointer !important; border: none; font-weight: 900; border-radius: 50%; background-color: transparent; }</style><div style="display: none" data-id="0.2.11" class="announcement-banner"> <p><em>正在逐步完善中。。。</em></p> <button type="button" data-close>X</button></div><script>(() => { const banner = document.querySelector(".announcement-banner"); const id = banner.getAttribute("data-id"); const message = banner.querySelector("p").textContent; const localData = JSON.parse(localStorage.getItem("mdbook-announcement-banner")); if (!localData || localData.id !== id || localData.hide !== true) { banner.style.display = "flex"; const page = document.querySelector(".page"); page.parentNode.insertBefore(banner, page); banner.querySelector("button").addEventListener("click", () => { banner.remove(); localStorage.setItem("mdbook-announcement-banner", JSON.stringify({ id, hide: true, message })); }); } })();</script><style>.giscus { margin-top: 6rem; }</style><script src="https://giscus.app/client.js" data-repo="arceos-hypervisor/doc" data-repo-id="R_kgDOLMHfvQ" data-category="Comments" data-category-id="DIC_kwDOLMHfvc4CoqAB" data-mapping="title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-lang="zh-CN" data-loading="eager" crossorigin="anonymous" data-theme="light" async></script><script>(() => { const giscusScript = document.querySelector("script[data-repo][data-repo-id]"); if (giscusScript?.getAttribute("data-theme") !== "book") return; const mapTheme = (theme) => (["light", "rust"].includes(theme) ? "light" : "dark"); const bookTheme = localStorage.getItem("mdbook-theme") || html.getAttribute("class"); giscusScript.setAttribute("data-theme", mapTheme(bookTheme)); document.querySelectorAll("button[role='menuitem'].theme").forEach((btn) => { btn.addEventListener("click", (event) => { const theme = mapTheme(event.target.id); const iframe = document.querySelector("iframe.giscus-frame"); if (iframe) iframe.contentWindow.postMessage({ giscus: { setConfig: { theme } } }, "*"); }); }); })();</script><style>footer { text-align: center; text-wrap: balance; margin-top: 5rem; display: flex; flex-direction: column; justify-content: center; align-items: center; } footer p { margin: 0; }</style><footer><p>Copyright © 2025 • Created by ArceOS Team</p></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../quickstart/qemu/qemu_x86_64.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../quickstart/aarch64/aarch64.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../quickstart/qemu/qemu_x86_64.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../quickstart/aarch64/aarch64.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>

        <script src="../../ace.js"></script>
        <script src="../../editor.js"></script>
        <script src="../../mode-rust.js"></script>
        <script src="../../theme-dawn.js"></script>
        <script src="../../theme-tomorrow_night.js"></script>

        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../theme/pagetoc.js"></script>


    </div>
    </body>
</html>
